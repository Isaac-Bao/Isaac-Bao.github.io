# Character & Weapon

> Via [@Isaac Bao](https://ganzhe.site)

---

> 注⚠️：本文原文在[Feishu Docs](https://m0dorknyq14.feishu.cn/docx/CZlFdMmrUoY3QFx8XVZcaStenBe?from=from_copylink)，文中的`[图片]`以及`暂时无法在飞书文档外展示此内容`字样的内容可能无法在飞书文档外展示，后续会逐渐补上

## 11.28
- IA的trigger设定
- 关于蓝牙鼠标会触发两次射击的信息……
- Fire的logic更新
- 每把枪有自己的ammon。temp = total（original numbers of ammon）
    - 直接从Weapon master（holding gun）里调变量
- 射速（Firing Rate）
> 主要完成了`即时获取holding gun的各种变量（弹药）`

## 11.26
今天似乎有水log的嫌疑了……总之**更新一下下一步的一些计划吧**：
1. 即时获取holding gun的各种变量（弹药）
2. 开镜动作
3. 探头动作
4. 持枪animation优化（Animation starter pack）
  - 射击时animation要有变化（状态机）关键是变啥动作捏。。
5. 腰射散布（偏中心，这样可以解决枪口在右不符合腰射预期的问题）
6. 简易换弹动作
7. 一手枪一步枪

**`Demo3`的人物和武器**的部分基本到此结束

## 11.25
- 想起来在哪里绑定function了(UI widget)
- 新增了换弹提示
- 新增了isHoldingRifle的判断，在不拿枪时不会显示子弹数的UI

## 11.24
- 进一步完善了换弹：按R换弹（子弹满时不让换弹；若开始换弹就不能开枪）
- 做了两次isReloading?的检测
- 加入重置换弹时间。因为这次的逻辑漏洞是如果点换弹之后丢掉枪，在没有重新attach的时间内，“换弹”的时间依旧在走，于是就会出现枪在自动换弹的情况。
  - 这时如果加入这个重置，再捡起来抢时，原本在走或者走完的时间就会被重置，并且这时已经不再走了，等于进程被重置了。（思路貌似有点野，我只能描述成这样了）
- 效果一览：
- 貌似更进一步的瓶颈的卡点在这里
- 今天就先到此为止。尝试修改变量，结果改着改着，我寻思我既然还是自己默认的，还没get到子类自己的变量呢，那我不是重蹈覆辙吗？于是我又该回去了🤦‍♂️

## 11.23
- How to实现弹药量的初步版本
[图片]
暂时无法在飞书文档外展示此内容
暂时无法在飞书文档外展示此内容
- 终于大功告成……虽然留了一个delay0不知如何处理，但至少不影响也不算bug
暂时无法在飞书文档外展示此内容
- 下一步想做弹药量的UI显示。既然已经知道cast to的as xxx是可以用来get那个对象的变量，那么UI自然也不难。不过现在很晚了——3:33——我也不是很清楚要不要继续……
- 这个只是开始录了第一个视频而已，估计从一点半左右就开始了
[图片]
- 真的忙了2个多小时左右……
[图片]
- 自学（视频自学以及@季鲁的参考思路）
[图片]
[图片]
[图片]
[图片]
- 最主要的是自己花费1个多小时梳理逻辑，搞懂了这个a = a -1的蓝图写法以及（在这个循环中的）变量更新逻辑（a = a - 1中的a =）
- 补充说明：目前的效果是基于忽略了cast to的一种方法。弊端就是确实没有做到get到具体枪上的变量，而是在character的blueprint内新增了一个变量ammunition BP_character。结果就是导致所有的枪都共用一个ammunition的值（30），并且“共用（目前启动一次就）有且仅有一个的弹夹”
  - 这么做是为了避免cast to之后总是在调用时将值刷新成默认值（这一点我觉得应该是有方法的，不过我目前没探索出来，探索了一个多小时，最后还是把cast to删掉了……）
暂时无法在飞书文档外展示此内容
- 疑问：这个东西我不太清楚需不需要勾选下面两个选项。对于上面提到的cast to就会更新有无影响？
[图片]
- 取消情景关联，终究是发现新大陆了……我管你make不make sense，不报错能用不就行了
[图片]
- 来自于kimi给我的贴吧帖子：
[图片]
- 目前UI也算是一个半成品，因为丢枪之后不会消失……额问季鲁吧，我至少核心功能是明白的
暂时无法在飞书文档外展示此内容
- 效果就是这样啦~ 真的很有才成就感，5:07了，但还是很开心~ 毕竟是自己捣鼓出来的，核心的get的方法也是触类旁通自己悟出来的，基本上全程是很顺利的，除了隐藏/删除组件不是很清楚之外，小卡点也就是关闭关联情景的事情啦
- 好发现bug了
暂时无法在飞书文档外展示此内容
- 好解决了，我真是进步飞速啊debug能力🤣
  - 这里说明一下，如果shooting function内部没有检测的话，若在空手时开枪，游戏结束会报错，但不影响功能使用
[图片]
- 今日（到24日白天之前）成果总览：

## 11.22

- 修改了gun们的触发box，让Collider尽量对齐枪体
  
  > 有图片和视频的讲解……但是时间有限就先鸽到周末再找时间补充

## 11.21

- 完善了pick up、replace和drop，手里有枪或者没枪都可以实现多次的丢、捡枪
  
  > 有图片和视频的讲解……但是时间有限就先鸽到周末再找时间补充

## 11.20

- 在@季鲁的帮助下进一步完善了捡枪和丢枪的蓝图
  - 增加了simulate physics
  - 修复了detach的bug
    [图片]
    [图片]
- 不过依旧有bug：丢枪之后不能再捡枪；因为碰撞的原因不能踩在抢上会卡飞
  暂时无法在飞书文档外展示此内容
- 开始着手搭建GitHub page
  [图片]
  [图片]

## 11.19

- 和@季鲁研究了两节课。挺好，进展很多。
  1. 优化了射击位置和准心的问题
  2. 优化了捡枪流程
     [图片]
     暂时无法在飞书文档外展示此内容

## 11.17

- 写到这里就不知道怎么写了
  [图片]

## 11.14

- 解决了手上没枪就可以射击以及有射击音效的问题
  [图片]
- 解决了找不到枪上的Firepoint的问题
  [图片]
  [图片]
- 决定重构 Weapon System... 现在的蓝图内容太乱了，维护性扩展性也都不好

## 11.11

- 貌似必须要一开始就拿着才行，不能后来再检测手上枪的bone
  暂时无法在飞书文档外展示此内容

## 11.10

- 终于修好了，在和我妈打电话的时候修好的
  [图片]
  [图片]
- 相信直觉！
  暂时无法在飞书文档外展示此内容
- 在想关于FirePoint的bug……结果……
  暂时无法在飞书文档外展示此内容
- 通过这个奇怪的方式解决了……从那大老远拉过来一个点……
  [图片]
- 不过就是搞不清楚，我都能换你的location了，为啥不能通过调你的角度来让我的程序变成Forward也可以……
  https://m0dorknyq14.feishu.cn/sync/UFGqd4KaUsxry9bwBhUc2VkDnTb
- 也就是把firepoint还是放在枪上。这样自然就只能捡到枪才能开火了
  [图片]
  [图片]
- 下一步的计划呢，就是在不修改程序的情况下适配所有的枪，也就是这些firepoint啥的……
- 哦！那我为什么不服从多数把vandal ak的firepoint也改成那个什么b_gun_muzzleflash呢?这样从这一步就是统一的了。剩下的就是持枪的位置吧……
- 不知为什么，把手上的枪去掉之后又变成normal了……
  [图片]
- 不知为什么，这个点还是改不了，还是从root的位置发射的……
  [图片]
  [图片]

## 11.8

- 个人项目15分钟左右做出了一个这个东西，虽然transition的判断条件是一样的但是播放动画并不是一样的，我就先简单地弄了两个falling的动画了，估计这样是冗余的吧。
  [图片]
  [图片]
- Complie之后出现了一个这样的报错：
  [图片]
  也是不太清楚是啥
- 总结一下目前的进度：
  暂时无法在飞书文档外展示此内容
  - Bug
    暂时无法在飞书文档外展示此内容
- 优化回去了FirePoint
  [图片]
- 想找到瓦的那种感觉
  [图片]
  [图片]
  - 尝试对比……
    [图片]
  - 尽力了，有点csgo 4:3 AK的感觉
    [图片]

## 11.7

1. 现在可以拿枪后是拿枪的动作了（get到了变量）
2. 知道了，原来还可以在这个项目里新建一个第三人称的，然后里面有完整的状态机
   [图片]
   [图片]
- 晚上问出了心中的疑问。感觉这个新东西还是复杂，不知道熟悉了会不会好一些
  [图片]

## 11.6

1. 改动了Firepoint的位置
   [图片]
2. 改动了weapon的位置以优化手感，即调整了枪械在视角中的位置
   [图片]
3. 接下来准备学状态机state machine：(居然还是这个哥们教)
   [图片]
4. 第一次自己学会了！算是初步成功了，至少animation应用上了：
   [图片]
   暂时无法在飞书文档外展示此内容
   [图片]

## 11.1

之前的报错解决了，是一个蓝图的点没连上：
[图片]
今天主要干了3个：

1. 瞄准（从摄像机发射）

2. 加了开枪montage

3. 略微优化了camera和arm的相对位置，稍微优化了一些视野和手感

4. 瞄准。瞄准这件事我在前两天就发现子弹发射的位置是手臂上的weapon socket，而这样的子弹发射位置并不合理。随后我尝试着寻找怎么绑在枪口的bone上，不过失败了，没有找到如何绑上去。昨天呢我看youtube复习widget如何添加，尝试在屏幕中心用2条垂直的白色image作为准心，不过昨天时间不够了我就没有继续弄了。于是今天在下午的个人项目课我就把shoot system补齐了一下，然后在摄像机的中心点稍微往前一些的位置放了一个mesh，用来作为子弹发射的点，总之很正就完了。不过感觉作为强迫症还是有遗憾的，毕竟这个效果和瓦、CS还是不一样的。说实话，我有点没搞懂为什么瓦和CS可以一直把子弹中心点控制在屏幕中心的位置（距离不同是需要调整枪口的子弹角度的。还是说，他们根本不是用枪口的那个位置？）

5. 一开始我找到的montage并不能应用在FirstPersonCharacter的arm上。后来我直接对这个arm的skeletal mesh重新创建了一个montage，手动加了Rifle_fire的animation。不过动作幅度依旧很小。

6. 调整camera/视角（最后调整的是手臂）的位置原因说过了。虽然我知道光调整视角并不能够彻底地解决问题，但是还是先尝试了调整手臂。调整后明显要好一些，至少是可以看到左小臂的。
   [图片]


## The Bginning
